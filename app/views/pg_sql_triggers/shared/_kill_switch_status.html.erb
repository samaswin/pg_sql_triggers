<%# Kill Switch Status Indicator %>
<%# Displays the current kill switch status and environment warning if applicable %>

<%
  # Debug info (can be removed in production)
  env = current_environment
  is_active = kill_switch_active?
  protected_envs = PgSqlTriggers.respond_to?(:kill_switch_environments) ? PgSqlTriggers.kill_switch_environments : %i[production staging]
  kill_switch_enabled_global = PgSqlTriggers.respond_to?(:kill_switch_enabled) ? PgSqlTriggers.kill_switch_enabled : true

  # Log for debugging (remove in production)
  Rails.logger.debug "[KILL_SWITCH_VIEW] is_active=#{is_active} env=#{env} protected_envs=#{Array(protected_envs).map(&:to_s).join(',')}"
%>

<% if is_active %>
  <div class="kill-switch-status active" style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 12px; margin-bottom: 16px;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <span style="font-size: 20px;">üõ°Ô∏è</span>
      <div>
        <strong style="color: #856404;">Kill Switch Active</strong>
        <p style="margin: 4px 0 0 0; font-size: 14px; color: #856404;">
          Dangerous operations in <strong><%= env %></strong> require confirmation.
          All operations are logged and audited.
        </p>
      </div>
    </div>
  </div>
<% else %>
  <div class="kill-switch-status inactive" style="background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; padding: 12px; margin-bottom: 16px;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <span style="font-size: 20px;">‚ÑπÔ∏è</span>
      <div>
        <strong style="color: #0c5460;">Kill Switch Inactive</strong>
        <p style="margin: 4px 0 0 0; font-size: 14px; color: #0c5460;">
          Kill switch is disabled in <strong><%= env %></strong>.
          Operations can be performed without confirmation.
        </p>
        <details style="margin-top: 8px; font-size: 12px; color: #6c757d;">
          <summary style="cursor: pointer; color: #495057;">Debug Info</summary>
          <div style="margin-top: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-family: monospace;">
            <div>Environment: <strong><%= env %></strong></div>
            <div>Global Enabled: <strong><%= kill_switch_enabled_global %></strong></div>
            <div>Protected Environments: <strong><%= Array(protected_envs).map(&:to_s).join(', ') %></strong></div>
            <div style="margin-top: 4px; font-size: 11px; color: #6c757d;">
              <% if !kill_switch_enabled_global %>
                ‚ö†Ô∏è Kill switch is globally disabled
              <% elsif !Array(protected_envs).map(&:to_s).include?(env.to_s) %>
                ‚ö†Ô∏è Current environment is not in protected list
              <% else %>
                ‚úì Configuration looks correct
              <% end %>
            </div>
          </div>
        </details>
      </div>
    </div>
  </div>
<% end %>
